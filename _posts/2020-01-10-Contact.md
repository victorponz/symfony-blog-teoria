---

typora-copy-images-to: ../assets/img/contact/
typora-root-url: ../../
layout: post
categories: parte2
conToc: true
---

## 2.0 ¿Qué aprenderemos?

* A conectar con una base de datos
* A generar entidades y repositorios
* A generar formularios
* A guardar los datos del formulario en la base de datos
* A realizar validaciones en los campos
* A personalizar los campos de los formularios

## 2.1 Base de datos

En esta parte del curso vamos a crear el formulario para que se puedan enviar mensajes.

![image-20220316180158448](/symfony-blog-teoria/assets/img/contact/image-20220316180158448.png)

### 2.1.1 Conexión con la base de datos

Para crear la base de datos, hemos de modificar el archivo `.env` introduciendo la url apropiada. En el caso de MySql es la siguiente

```
DATABASE_URL="mysql://db_user:db_password@127.0.0.1:3306/blog?serverVersion=5.7&charset=utf8mb4"
```

Sustituyendo `db_user` y  `db_password` por los valores apropiados y `blog` es el nombre de la base de datos. Para crearla se usa el comando:

```
php bin/console doctrine:database:create
```

### 2.1.2 Creación de la entidad `Mensaje`

El primer paso para trabajar con la Base de Datos es definir la entidad en la que debemos almacenar los datos. En principio, una entidad equivale a una tabla en la base de datos. Para crearla usamos el siguiente comando:

```
php bin/console make:entity
```
Nos pedirá los nombres y atributos de los campos de la entidad:

<script id="asciicast-lLADF9SMjxzB8DsDAzAt45s9l" src="https://asciinema.org/a/lLADF9SMjxzB8DsDAzAt45s9l.js" async></script>

Ahora ya sólo nos queda crear la tabla asociada en la base de datos mediante los siguientes comandos

```
php bin/console make:migration
```

Y por último aplicar la migración:

```
php bin/console doctrine:migrations:migrate
```

### 2.1.3 Clases `Contact` y `ContactRepository`

Al ejecutar el comando `php bin/console make:entity` Symfony ha creados dos archivos. Uno llamado `App\Entity\Contact.php` que almacena la definición de la entidad-tabla y otro llamado `App\Repository\ContactRepository.php` que es la clase encargada de realizar las tareas relacionadas con la entidad `Contact`. 

## 2.2 Formulario

Una vez hemos definido la entidad que va a almacenar los datos introducidos, vamos a crear el formulario. Symfony posee un comando que, automáticamente, crea un formulario a partir de la entidad subyacente. 

```
php bin/console make:form ContactForm Contact
```

El código generado en `Form\ContactoForm.php` es el siguiente:

```php
<?php

namespace App\Form;

use App\Entity\Contact;
use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\FormBuilderInterface;
use Symfony\Component\OptionsResolver\OptionsResolver;ç
```

